<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban - Albert & Rony</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        h1 { font-size: 1.8rem; font-weight: 600; }
        .header-actions { display: flex; gap: 10px; align-items: center; }
        .sync-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .sync-status.synced { background: #10b981; }
        .sync-status.syncing { background: #f59e0b; }
        .sync-status.error { background: #ef4444; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        button:hover { background: #2563eb; }
        button.secondary { background: #4b5563; }
        button.secondary:hover { background: #374151; }
        .board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .column {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            min-height: 400px;
        }
        .column-header {
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .column-count {
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        .column.backlog .column-header { color: #a78bfa; }
        .column.inprogress .column-header { color: #fbbf24; }
        .column.review .column-header { color: #38bdf8; }
        .column.done .column-header { color: #4ade80; }
        .cards { display: flex; flex-direction: column; gap: 10px; min-height: 100px; }
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .card.dragging { opacity: 0.5; }
        .card-title { font-weight: 500; margin-bottom: 6px; padding-right: 24px; }
        .card-desc { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
        .card-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.3);
            cursor: pointer;
            padding: 4px;
            font-size: 1rem;
            line-height: 1;
        }
        .card-delete:hover { color: #ef4444; background: none; }
        .column.drag-over { background: rgba(255,255,255,0.1); }
        .add-form {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .add-form input, .add-form select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 0.9rem;
        }
        .add-form input::placeholder { color: rgba(255,255,255,0.4); }
        .add-form input[type="text"]:first-of-type { flex: 1; min-width: 200px; }
        .add-form input[type="text"]:nth-of-type(2) { flex: 2; min-width: 250px; }
    </style>
</head>
<body>
    <header>
        <h1>ðŸ“‹ Kanban Board</h1>
        <div class="header-actions">
            <span class="sync-status syncing" id="sync-status">Syncing...</span>
            <button class="secondary" onclick="loadTasks()">ðŸ”„ Refresh</button>
        </div>
    </header>

    <div class="add-form">
        <input type="text" id="new-title" placeholder="Task title..." />
        <input type="text" id="new-desc" placeholder="Description (optional)" />
        <select id="new-column">
            <option value="backlog">Backlog</option>
            <option value="inprogress">In Progress</option>
            <option value="review">Review</option>
            <option value="done">Done</option>
        </select>
        <button onclick="addTask()">+ Add Task</button>
    </div>

    <div class="board">
        <div class="column backlog" data-status="backlog">
            <div class="column-header">ðŸ“¥ Backlog <span class="column-count" id="count-backlog">0</span></div>
            <div class="cards" id="backlog"></div>
        </div>
        <div class="column inprogress" data-status="inprogress">
            <div class="column-header">ðŸ”¨ In Progress <span class="column-count" id="count-inprogress">0</span></div>
            <div class="cards" id="inprogress"></div>
        </div>
        <div class="column review" data-status="review">
            <div class="column-header">ðŸ‘€ Review <span class="column-count" id="count-review">0</span></div>
            <div class="cards" id="review"></div>
        </div>
        <div class="column done" data-status="done">
            <div class="column-header">âœ… Done <span class="column-count" id="count-done">0</span></div>
            <div class="cards" id="done"></div>
        </div>
    </div>

    <script>
        const BIN_ID = '69827a57d0ea881f409e8bc6';
        const API_KEY = '$2a$10$jiu.OJNS24heHS2Hilv5x.3zeQTzLRp5Z83U0RBsUq5lLBpjEs1li';
        const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

        let tasks = { backlog: [], inprogress: [], review: [], done: [] };
        let draggedCard = null;

        function setStatus(status, text) {
            const el = document.getElementById('sync-status');
            el.className = 'sync-status ' + status;
            el.textContent = text;
        }

        async function loadTasks() {
            setStatus('syncing', 'Loading...');
            try {
                const res = await fetch(API_URL + '/latest', {
                    headers: { 'X-Master-Key': API_KEY }
                });
                const data = await res.json();
                tasks = data.record;
                render();
                setStatus('synced', 'âœ“ Synced');
            } catch (e) {
                setStatus('error', 'âœ— Error');
                console.error(e);
            }
        }

        async function saveTasks() {
            setStatus('syncing', 'Saving...');
            try {
                await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY
                    },
                    body: JSON.stringify(tasks)
                });
                setStatus('synced', 'âœ“ Synced');
            } catch (e) {
                setStatus('error', 'âœ— Error');
                console.error(e);
            }
        }

        function render() {
            ['backlog', 'inprogress', 'review', 'done'].forEach(col => {
                const container = document.getElementById(col);
                const count = document.getElementById('count-' + col);
                container.innerHTML = '';
                count.textContent = tasks[col].length;
                tasks[col].forEach(task => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.draggable = true;
                    card.dataset.id = task.id;
                    card.innerHTML = `
                        <button class="card-delete" onclick="deleteTask('${task.id}', '${col}')">&times;</button>
                        <div class="card-title">${escapeHtml(task.title)}</div>
                        ${task.description ? `<div class="card-desc">${escapeHtml(task.description)}</div>` : ''}
                    `;
                    card.addEventListener('dragstart', handleDragStart);
                    card.addEventListener('dragend', handleDragEnd);
                    container.appendChild(card);
                });
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function addTask() {
            const title = document.getElementById('new-title').value.trim();
            const desc = document.getElementById('new-desc').value.trim();
            const col = document.getElementById('new-column').value;
            if (!title) return;
            tasks[col].push({
                id: Date.now().toString(),
                title: title,
                description: desc
            });
            document.getElementById('new-title').value = '';
            document.getElementById('new-desc').value = '';
            render();
            saveTasks();
        }

        function deleteTask(id, col) {
            tasks[col] = tasks[col].filter(t => t.id !== id);
            render();
            saveTasks();
        }

        function handleDragStart(e) {
            draggedCard = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.column').forEach(c => c.classList.remove('drag-over'));
            draggedCard = null;
        }

        document.querySelectorAll('.column').forEach(column => {
            column.addEventListener('dragover', e => {
                e.preventDefault();
                column.classList.add('drag-over');
            });
            column.addEventListener('dragleave', () => {
                column.classList.remove('drag-over');
            });
            column.addEventListener('drop', e => {
                e.preventDefault();
                column.classList.remove('drag-over');
                if (!draggedCard) return;
                const taskId = draggedCard.dataset.id;
                const fromCol = draggedCard.parentElement.id;
                const toCol = column.dataset.status;
                if (fromCol === toCol) return;
                const taskIndex = tasks[fromCol].findIndex(t => t.id === taskId);
                if (taskIndex === -1) return;
                const [task] = tasks[fromCol].splice(taskIndex, 1);
                tasks[toCol].push(task);
                render();
                saveTasks();
            });
        });

        // Load on start
        loadTasks();
    </script>
</body>
</html>
